/**
  **************************************************************************************************************************
  * File Name          : measurement.c
  * Description        : This file provides code for receiving and converting data from BH1750 sensor.
  **************************************************************************************************************************
  */

#include "measurement.h"
/**
  * @brief Initialize sensor BH1750
  * @retval None
  */
void BH1750_Init()
{
	uint8_t tmp;

	/* power on sensor BH1750 */
	tmp = BH1750_POWER_ON;
	HAL_I2C_Master_Transmit(&hi2c1, BH1750_ADDRESS, &tmp, 1, 0xffff);

	/* choosing measurement mode */
	tmp = BH1750_CONTINOUS_H_RES_MODE;
	HAL_I2C_Master_Transmit(&hi2c1, BH1750_ADDRESS, &tmp, 1, 0xffff);
}

/**
  * @brief Read value from sensor BH1750
  * @retval Measured luminous intensity in lux
  */
float BH1750_Read()
{
	float brightness_LUX = 0; // declaration of brightness in LUX
	uint8_t buff[2];

	HAL_I2C_Master_Receive(&hi2c1, BH1750_ADDRESS, buff, 2, 0xffff);	// Read value from sensor
	brightness_LUX = ((buff[0]<<8) | buff[1]) / 1.2;						// Converting measurement value to LUX

	return brightness_LUX; // return brightness value in LUX
}

